<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('latar 2.jpg'); /* Ganti 'jpg' dengan nama file gambar Anda */
    background-size: cover; /* Untuk memastikan gambar meliputi seluruh latar belakang */
    background-repeat: no-repeat; /* Menghindari pengulangan gambar */
    background-position: center center; /* Posisi gambar di tengah-tengah latar belakang */


            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .profile-card {
            background-color: rgba(29, 29, 29, 0.7);
            color: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid #ff6915;
            width: 90%;
            max-width: auto;
        }

        .card-content {
            padding: auto;
            text-align: center;
        }

        .profile-card h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .button-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .logout-button,
        .redeem-button,
        .home-button,
        .exchange-button,
        .choose-file-button,
        .save-button {
            background-color: #ff4400;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .logout-button:hover,
        .redeem-button:hover,
        .home-button:hover,
        .exchange-button:hover,
        .choose-file-button:hover,
        .save-button:hover {
            background-color: #ff5f26;
        }

        #profile-picture {
            display: none;
        }

        .choose-file-button {
            background-color: #4caf50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .choose-file-button:hover {
            background-color: #45a049;
        }

        .save-button {
            background-color: #008CBA;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
        }

        .save-button:hover {
            background-color: #005f6b;
        }

        .exchange-button {
            background-color: #ff5e00;
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .exchange-button:hover {
            background-color: #ff5e00;
        }        
        a.home-button {
  text-decoration: none;
}
 
  
    .profile-card {
        text-align: center;
    }

    .profile-picture {
        width: 160px; /* Lebar gambar profil */
        height: 160px; /* Tinggi gambar profil */
        border-radius: 50%; /* Untuk membuat gambar menjadi lingkaran */
        object-fit: cover; /* Untuk mempertahankan rasio aspek dan mengisi kotak gambar */
        margin: 20px auto; /* Membuat gambar berada di tengah */
        display: block; /* Menghilangkan spasi di sekitar gambar */
    }
</style>

<div class="profile-card">
    <center>
        <h2>Selamat Datang, <span id="username"></span>!</h2>
        <p>Koin Anda: <span id="coin-count"></span></p>
    </center>
    <div class="button-container">
        <a href="https://bit.ly/3tETDK3" class="home-button">Home</a>
        <button onclick="redeemCode()" class="redeem-button">Redeem Kode</button>
        <button onclick="logout()" class="logout-button">Logout</button>
    </div>
    
    <div class="card-content">
        <h3>Member</h3>
        <hr>
        <img src="uang.jpg" alt="Preview" class="profile-picture">
    </div>
    <hr>
    <br>
    <center>
        <a href="penukaran.html" class="exchange-button">Tukar Koin</a>
    </center>
    <br>
</div>
    <script>
        // Mendapatkan data pengguna dari localStorage
        var storedUser = JSON.parse(localStorage.getItem('user'));
        var storedUsername = storedUser.username;
        var coinCountKey = storedUsername + '-coins';
        var usedCodesKey = storedUsername + '-usedCodes';
        var coinCount = parseInt(localStorage.getItem(coinCountKey)) || 0; // Jumlah koin, defaultnya 0 jika tidak ada di localStorage

        // Membuka koneksi ke IndexedDB
        var request = indexedDB.open("UserData", 1);

        request.onsuccess = function (event) {
            var db = event.target.result;
            var transaction = db.transaction(["users"], "readonly");
            var objectStore = transaction.objectStore("users");

            // Mengambil data pengguna dari IndexedDB berdasarkan username
            var getUserRequest = objectStore.get(storedUser.username);

            getUserRequest.onsuccess = function (event) {
                var indexedDBUser = event.target.result;
                if (indexedDBUser) {
                    storedUser = indexedDBUser;
                }

                // Menampilkan nama pengguna dan jumlah koin di halaman profil
                document.getElementById('username').textContent = storedUser.name;
                document.getElementById('coin-count').textContent = coinCount;
            };
        };

        function redeemCode() {
            // Meminta pengguna memasukkan kode redeem
            var redeemCodeInput = prompt('Masukkan kode redeem:');
            var validCodes = ['l.', 'lb', 'lc', 'ld', 'le', 'lf', 'lu', 'lg', 'lh', 'li', 'lj', 'lk', 'll', 'lm', 'ln', 'lo', 'lr', 'lp', 'ms', 'lz'];
            var rewardCoins = 2;

            // Mengambil daftar kode redeem yang sudah digunakan oleh pengguna dari localStorage
            var usedCodes = JSON.parse(localStorage.getItem(usedCodesKey)) || [];

            // Memeriksa apakah kode redeem yang dimasukkan oleh pengguna valid dan belum digunakan sebelumnya
            if (validCodes.includes(redeemCodeInput) && !usedCodes.includes(redeemCodeInput)) {
                // Menambahkan jumlah koin ke localStorage dan memperbarui tampilan jumlah koin di halaman
                coinCount += rewardCoins;
                localStorage.setItem(coinCountKey, coinCount);
                document.getElementById('coin-count').textContent = coinCount;

                // Menandai bahwa kode redeem telah digunakan
                usedCodes.push(redeemCodeInput);
                localStorage.setItem(usedCodesKey, JSON.stringify(usedCodes));

                alert('Redeem berhasil! Anda mendapatkan ' + rewardCoins + ' koin.');
            } else if (usedCodes.includes(redeemCodeInput)) {
                alert('Anda sudah menggunakan kode redeem ini sebelumnya.');
            } else {
                alert('Kode redeem tidak valid. Silakan coba lagi.');
            }
        }

        function logout() {
            // Menghapus data jumlah koin dan kode redeem yang sudah digunakan dari localStorage
            

            // Mengarahkan pengguna ke halaman login setelah logout
            window.location.href = 'login.html';
        }

        

                
    </script>
</body>

</html>
